 <!DOCTYPE html>
<html>
    <head>
        <title>template</title>
        <link type="text/css" rel="stylesheet" media="screen" href="css/page.css" />
    </head>
    <body>
        <script src="js/mootools-core-1.4.5.js" type="text/javascript"></script>
        <script src="js/mootools-more-1.4.0.1.js" type="text/javascript"></script>
        <script src="js/Template.js" type="text/javascript"></script>
        <script src="js/TAN.js" type="text/javascript"></script>
        <script type="text/javascript">
            var tan;
            window.addEvent('domready', function(){
                //TODO IRL this will be part of the page request or something
                var config;
                new Request.JSON({
                    "url": 'json/config.json',
                    "async": false,
                    "method": "get",
                    "onSuccess": function( json ){
                        config = json;
                    }
                }).send();

                tan = new TAN( config );

                var objects = [];

                new Request.JSON({
                    'url': 'json/0.json',
                    'async': false,
                    'method': 'get',
                    "onSuccess": function( json ){
                        objects.push( json );
                    }
                }).send();
                
                new Request.JSON({
                    'url': 'json/1.json',
                    'async': false,
                    'method': 'get',
                    "onSuccess": function( json ){
                        objects.push( json );
                    }
                }).send();

                var body_templates = [];
                body_templates.push(
                    tan.template.process("lib/config"),
                    tan.template.process("lib/header"),
                    tan.template.process("body").adopt(
                        tan.template.process('lib/column').adopt(
                            tan.template.process('lib/object', objects[0])
                        ),
                        tan.template.process('lib/column').adopt(
                            tan.template.process('lib/object', objects[1])
                        ),
                        tan.template.process('lib/column'),
                        new Element('br', {
                            'class': 'clear'
                        })
                    ),
                    tan.template.process("lib/footer")
                );

                $$('head')[0].adopt(
                    tan.template.process('lib/css')
                );
                
                $$('body')[0].adopt(
                    body_templates
                );
            });
        </script>
    </body>
</html>
