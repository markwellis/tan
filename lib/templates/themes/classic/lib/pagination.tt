[%-
total_pages = (index_objects.pager.total_entries / index_objects.pager.entries_per_page) + 1 | format("%d");
show_this_many = 6;
current_page = index_objects.pager.current_page;

lower = current_page - show_this_many;
max = current_page + show_this_many;

IF (lower <= 1);
    lower = 1;
    max = max + show_this_many;
END;

IF (max >= total_pages);
    lower = total_pages - (2 * show_this_many);
    IF (lower <= 1);
        lower = 1;
    END;

    max = total_pages;
END -%]

<div id="page_no_holder">
[%- IF (lower != 1) -%]
    <a class="pageNumber" href="/index/[%- "$location/$upcoming" -%]/1/">1</a>
    <span class="pageNumber">...</span>
[%- END -%]

[%- FOREACH page = [ lower .. max ] -%]
    <a class="pageNumber[%- IF (page == current_page) -%] thisPage[%- END -%]" href="/index/[%- "$location/$upcoming" -%]/[%- page -%]/">
        [%- page -%]
    </a>
[%- END -%]

[%- IF (max != total_pages) -%]
    <span class="pageNumber">...</span>
    <a class="pageNumber" href="/index/[%- "$location/$upcoming" -%]/[%- total_pages -%]/">[%- total_pages -%]</a>
[%- END -%]
</div>