LimitRequestBody 8388608
<VirtualHost *:443>
    ServerName thisaintnews.com
    ServerAlias dev.thisaintnews.com

    CustomLog ${APACHE_LOG_DIR}/access.tan.log combined

    DocumentRoot "/var/www/TAN/root"

    SSLEngine on
    SSLProtocol all -SSLv2
    SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM

    SSLCertificateFile      /var/www/TAN/conf/ssl/thisaintnews.crt
    SSLCertificateKeyFile   /var/www/TAN/conf/ssl/thisaintnews.key
    SSLCertificateChainFile /var/www/TAN/conf/ssl/sub.class1.server.ca.pem
    SSLCACertificateFile    /var/www/TAN/conf/ssl/ca.pem

    RequestHeader set X-Forwarded-Proto https
    RequestHeader set X-Forwarded-Port 443

    Header unset X-Catalyst

    <Directory />
        AllowOverride None
    </Directory>

    ProxyPass /static !
    ProxyPass / http://localhost:8081/

    RewriteEngine on
    RewriteRule /favicon.ico /static/favicon.ico [L]

    RewriteCond %{REQUEST_URI} =^/$
    RewriteRule "(.*)" "https://thisaintnews.com/index/all/0/$1" [R=302,NE,L]

    RewriteCond %{HTTP_HOST} !^(?:dev.)?thisaintnews.com
    RewriteRule ".*" "https://thisaintnews.com/index/all/0/" [R=302,NE,L]

    <Location /static>
        RewriteEngine on
        ErrorDocument 404 /static/error404.html

    #cache css/js
        RewriteCond %{REQUEST_FILENAME} !-f 
        #/static/cache/minify/4.1.04/mobile/css/shared
        #/static/cache/minify/4.1.04/mobile/js/somejs
        RewriteRule /static/cache/minify/([0-9\.]+)/(\w+)/(\w+)/(.*) http://localhost:8081/minify/$1/$2/$3/$4 [P]

    #cache images
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule /static/cache/thumbs/(.*)$ http://localhost:8081/thumb/$1 [P]
    
    #missing smilies
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule /static/smilies.*$ /static/images/blank.gif [L]

    #generally, static content can be cached for a loooong time
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
    </Location>
</VirtualHost>

<VirtualHost *:80>
    ServerName thisaintnews.com
    ServerAlias dev.thisaintnews.com

    CustomLog ${APACHE_LOG_DIR}/access.tan_redirect.log combined

    RewriteEngine On

    RewriteCond %{REQUEST_URI} ^www\.
    RewriteRule .* /index/all/0/ [NC]

    RewriteCond %{REQUEST_URI} =/
    RewriteRule .* /index/all/0/ [NC]

    RewriteRule "(.*)" "https://%{HTTP_HOST}$1" [R=302,NE,L]
</VirtualHost>
