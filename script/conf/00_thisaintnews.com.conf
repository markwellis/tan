ServerAdmin postmaster@thisaintnews.com

#PerlSetEnv CATALYST_DEBUG 1
#PerlSetEnv CATALYST_CONFIG_LOCAL_SUFFIX devel

#create new log format
LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" varnishcombined

<VirtualHost *:8080>
    ServerName thisaintnews.com

    PerlOptions +Parent
    PerlSwitches -I/var/www/thisaintnews.com/htdocs2/lib -I/mnt/stuff/perl_lib/lib/perl5
    PerlModule TAN

    LogLevel warn

    CustomLog /var/log/apache2/access.tan.log varnishcombined
    ErrorLog /var/log/apache2/error.log

    DocumentRoot "/var/www/thisaintnews.com/htdocs2/root"

    <Directory />
        AllowOverride None
    </Directory>

    <Location />
        SetHandler modperl
        PerlResponseHandler TAN

        LimitRequestBody 4194304
        ErrorDocument 404 /default

        RewriteEngine on

    #cache css/js
        RewriteCond %{REQUEST_FILENAME} !-f 
        #/static/cache/minify/4.1.04/mobile/css/shared
        #/static/cache/minify/4.1.04/mobile/js/somejs
        RewriteRule /static/cache/minify/([0-9\.]+)/(\w+)/(\w+)/(.*) /minify/$1/$2/$3/$4 [L]

    #cache images
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule /static/cache/thumbs/(.*)$ /thumb/$1 [L]
    
    #missing smilies
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule /static/smilies.*$ /static/images/blank.gif [L]
    </Location>

    <Location /static>
        SetHandler default

        #generally, static content can be cached for a loooong time
        ExpiresActive On
        ExpiresDefault "access plus 1 year"

    	FileETag MTime Size
    </Location>
</VirtualHost>
